C51 COMPILER V9.53.0.0   LCD                                                               11/29/2023 09:40:36 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE LCD
OBJECT MODULE PLACED IN LCD.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE LCD.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /**************************************************************************************************
   2          Nom du fichier : LCD.c
   3          Auteur : Xavier Champoux                 
   4          Date de création : 06-09-2023
   5          Version 1.0
   6             
   7            Ce programme sert à la créationde fonctions pour la mémoire 24LC32 et la communication I2C
   8              
   9              Versions:
  10              1.0 - 06 Septembre 2023:  Première version 
  11            
  12          ***************************************************************************************************/
  13          
  14          // *************************************************************************************************
  15          //  INCLUDES
  16          // *************************************************************************************************  
  17          
  18          #include <stdio.h>          // Prototype de declarations des fonctions I/O
  19            
  20          #include "ds89c450.h"       // Définition des bits et des registres du microcontrôleur
  21          #include "LCD.h"
  22          // *************************************************************************************************
  23          //  CONSTANTES
  24          // *************************************************************************************************
  25          
  26          
  27          // *************************************************************************************************
  28          // VARIABLES LOCALES
  29          // *************************************************************************************************
  30          
  31          unsigned char xdata *PtrLCDConfig = 0x8000;
  32          unsigned char xdata *PtrLCDBusy = 0x8001;
  33          unsigned char xdata *PtrLCDChar = 0x8002;
  34          
  35          // *************************************************************************************************
  36          //  FONCTIONS LOCALES
  37          // *************************************************************************************************
  38          
  39          void vAttendreBusyLcd(void);
  40          
  41          // *************************************************************************************************
  42          void vAttendreBusyLcd(void)
  43          //
  44          //  Auteur: Stéphane Deschênes  
  45          //  Date de création :  25-08-2019
  46          //  Version 1.0
  47          //
  48          //  Description: 
  49          //  Paramètres d'entrées : Aucun
  50          //  Paramètres de sortie : Aucun
  51          //  Notes                : Aucune
  52          // *************************************************************************************************
  53          {
  54   1        unsigned char i;
  55   1        while ( *PtrLCDBusy & 0x80 )
C51 COMPILER V9.53.0.0   LCD                                                               11/29/2023 09:40:36 PAGE 2   

  56   1        {
  57   2        };
  58   1        for(i=0; i<10; i++);  
  59   1      }
  60          // *************************************************************************************************
  61          void vInitialiseLCD(void)
  62          //
  63          //  Auteur: Stéphane Deschênes  
  64          //  Date de création :  25-08-2019
  65          //  Version 1.0
  66          //
  67          //  Description: 
  68          //  Paramètres d'entrées : Aucun
  69          //  Paramètres de sortie : Aucun
  70          //  Notes                : Aucune
  71          // *************************************************************************************************
  72          {
  73   1        unsigned int i; 
  74   1        
  75   1        for(i = 0; i < 12000; i++); //Delai d'activation de l'ecran au demarrage  
  76   1        vAttendreBusyLcd();
  77   1        *PtrLCDConfig = 0x38;       //Mode écran 8 bit, résolution charactère 5x7, mode 2 lignes
  78   1        vAttendreBusyLcd();
  79   1        *PtrLCDConfig = 0x0C;       //Display on, cursor & brink off
  80   1        vAttendreBusyLcd();
  81   1        *PtrLCDConfig = 0x06;       //Curseur en mode incrementation, display
  82   1        vAttendreBusyLcd(); 
  83   1        *PtrLCDConfig = 0x01;       //Clear display & return to address 0
  84   1        vAttendreBusyLcd();
  85   1      }
  86          // *************************************************************************************************
  87          void vLcdEcrireCaract(unsigned char ucCaract, unsigned char ucLigne, unsigned char ucColonne)
  88          //
  89          //  Auteur: Xavier Champoux   
  90          //  Date de création :  20-09-2023
  91          //  Version 1.0
  92          //
  93          //  Description: 
  94          //  Paramètres d'entrées : Aucun
  95          //  Paramètres de sortie : Aucun
  96          //  Notes                : Aucune
  97          // *************************************************************************************************
  98          {
  99   1        vAttendreBusyLcd();
 100   1        *PtrLCDConfig = ucLigne + ucColonne;
 101   1        vAttendreBusyLcd();
 102   1        *PtrLCDChar = ucCaract;
 103   1      }
 104          //// *************************************************************************************************
 105          //void vAfficheLigneLCD(unsigned char ucTab[],unsigned char ucLigne)
 106          ////
 107          ////  Auteur: Xavier Champoux   
 108          ////  Date de création :  20-09-2023
 109          ////  Version 1.0
 110          ////
 111          ////  Description: 
 112          ////  Paramètres d'entrées : Aucun
 113          ////  Paramètres de sortie : Aucun
 114          ////  Notes                : Aucune
 115          //// *************************************************************************************************
 116          //{
 117          //  unsigned char i = 0;
C51 COMPILER V9.53.0.0   LCD                                                               11/29/2023 09:40:36 PAGE 3   

 118          //  for (i=0; i<20; i++)
 119          //  {
 120          //    vLcdEcrireCaract(ucTab[i], ucLigne, i);
 121          //  }
 122          //}
 123          //*************************************************************************************************
 124          void vAfficheLCDComplet(unsigned char ucTab[4][21])
 125          //
 126          //  Auteur: Xavier Champoux   
 127          //  Date de création :  20-09-2023
 128          //  Version 1.0
 129          //
 130          //  Description: 
 131          //  Paramètres d'entrées : Aucun
 132          //  Paramètres de sortie : Aucun
 133          //  Notes                : Aucune
 134          // *************************************************************************************************
 135          {
 136   1        unsigned char i = 0;
 137   1        unsigned char j = 0;
 138   1        unsigned char ucLineFull;
 139   1        for (i=0; i<20; i++)
 140   1        {
 141   2          for (j=0; j<4; j++)
 142   2          {
 143   3            if(j==0){ucLineFull = LIGNE0;}
 144   3            if(j==1){ucLineFull = LIGNE1;}
 145   3            if(j==2){ucLineFull = LIGNE2;}
 146   3            if(j==3){ucLineFull = LIGNE3;}
 147   3            vLcdEcrireCaract(ucTab[j][i], ucLineFull, i);
 148   3          }
 149   2        }
 150   1      }
 151          //// *************************************************************************************************
 152          //void vEffaceLCD()
 153          ////
 154          ////  Auteur: Stéphane Deschênes, 
 155          ////  Date de création :  01-09-2019
 156          ////  Version 1.0
 157          ////
 158          ////  Description: Fait l'animation demandée, sur la ligne demandée
 159          ////  Paramètres d'entrées : 
 160          ////                         ucTab: Un tableau contenant des caractères voulus à chacune des étapes d'animation
 161          ////                                Les étapes sont faites ligne par ligne.
 162          ////                         ucLigne: Ligne sur laquelle on veut faire l'animation
 163          ////  Paramètres de sortie : Aucun
 164          ////  Notes                : Aucune
 165          //// *************************************************************************************************
 166          //{
 167          //  *PtrLCDConfig = 0x01;       //Clear display & return to address 0
 168          //  vAttendreBusyLcd();
 169          //}
 170          // *************************************************************************************************
 171          void vLoadCGRAM(unsigned char ucTab[8][8])
 172          //
 173          // Auteur: Stéphane Deschênes 
 174          // Date de création : 01-09-2019
 175          // Version 1.0
 176          //
 177          // Description: Met dans la mémoire CGRAM du contrôleur de LCD un tableau complet 
 178          // Paramètres d'entrées : Tableau qui contient toutes les caractères spéciaux voulus
 179          // Paramètres de sortie : Aucun
C51 COMPILER V9.53.0.0   LCD                                                               11/29/2023 09:40:36 PAGE 4   

 180          // Notes : Sert à créer des caractères spéciaux
 181          // *************************************************************************************************
 182          {
 183   1       unsigned char ucCompteurCaract;
 184   1       unsigned char ucCompteurOctetsDansCaract;
 185   1       // Boucle pour chacun des 8 caractères
 186   1       for (ucCompteurCaract= 0; ucCompteurCaract < 8; ucCompteurCaract++)
 187   1       {
 188   2        // Boucle pour chacune des 8 lignes dans un caractère
 189   2        for(ucCompteurOctetsDansCaract = 0; ucCompteurOctetsDansCaract < 8; ucCompteurOctetsDansCaract++)
 190   2        {
 191   3          vAttendreBusyLcd();
 192   3          *PtrLCDConfig = 0x40 + (8*ucCompteurCaract) + ucCompteurOctetsDansCaract;
 193   3          vAttendreBusyLcd();
 194   3          *PtrLCDChar = ucTab[ucCompteurCaract][ucCompteurOctetsDansCaract];
 195   3        }
 196   2       }
 197   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    292    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
